<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will You Be My Valentine?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* --- RESTORED NORMAL CURSOR --- */
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #fff5f7;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button, .catch-item, .hidden-item, input, .memory-card, .lock-target, #tower-box {
            cursor: pointer;
        }

        .cursive { font-family: 'Dancing Script', cursive; }

        #main-container {
            position: relative;
            transition: height 0.3s ease;
            z-index: 10;
        }

        /* --- Animations --- */
        #no-button { transition: all 0.2s ease-out; z-index: 50; }
        .heart { position: absolute; color: #ff4d6d; font-size: 20px; pointer-events: none; animation: float 4s linear forwards; z-index: 0; }
        @keyframes float { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; } }

        .falling-flower { position: fixed; top: -50px; font-size: 24px; pointer-events: none; animation: fallDown 3s linear forwards; z-index: 50; }
        @keyframes fallDown { to { transform: translateY(110vh) rotate(360deg); } }

        .swimming-fish { position: fixed; top: 50%; font-size: 30px; pointer-events: none; z-index: 50; visibility: hidden; }
        .swim-right { visibility: visible; animation: swimRight 3s linear both; }
        .swim-left { visibility: visible; animation: swimLeft 3s linear both; }
        @keyframes swimRight { from { left: -50px; transform: scaleX(1); } to { left: 110vw; transform: scaleX(1); } }
        @keyframes swimLeft { from { left: 110vw; transform: scaleX(-1); } to { left: -50px; transform: scaleX(-1); } }

        .container-box { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 2px solid #ffccd5; }
        .hidden { display: none !important; }
        .game-btn { transition: transform 0.1s; }
        .game-btn:active { transform: scale(0.95); }

        .catch-item { position: absolute; font-size: 2rem; cursor: pointer; animation: popIn 0.3s ease-out; user-select: none; z-index: 20; }
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .hidden-item { position: absolute; font-size: 2rem; cursor: pointer; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); transition: all 0.3s; animation: bounce 2s infinite; z-index: 20; }
        .hidden-item:hover { transform: scale(1.2) rotate(10deg); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .letter-modal { position: absolute; inset: 0; background: rgba(255, 245, 247, 0.95); display: flex; justify-content: center; align-items: center; z-index: 100; border-radius: 1.5rem; animation: fadeIn 0.3s ease; }
        .letter-content { background: white; padding: 2rem; border-radius: 1rem; width: 85%; text-align: center; border: 2px solid #fecdd3; box-shadow: 0 10px 25px rgba(255, 182, 193, 0.3); animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-origin: center; max-height: 90%; overflow-y: auto; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        /* Jumpy Animation for the Secret Button */
        @keyframes jumpy {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 
            40% {transform: translateY(-10px);} 
            60% {transform: translateY(-5px);} 
        }
        .jumpy-btn { animation: jumpy 2s infinite; display: inline-block; }

        /* --- SECRET GAMES CSS --- */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; width: 100%; max-width: 320px; margin: 0 auto; }
        .memory-card { aspect-ratio: 1; background: #fce7f3; border-radius: 0.5rem; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; cursor: pointer; transition: transform 0.3s, background 0.3s; transform-style: preserve-3d; }
        .memory-card.flipped { background: #fff; transform: rotateY(180deg); border: 2px solid #f9a8d4; }
        .memory-card.matched { background: #dcfce7; border-color: #86efac; opacity: 0.5; pointer-events: none; }

        .lock-container { width: 100%; height: 40px; background: #f3f4f6; border-radius: 20px; position: relative; overflow: hidden; border: 2px solid #e5e7eb; margin-bottom: 2rem; }
        .lock-target { position: absolute; height: 100%; width: 20%; background: #fbcfe8; left: 40%; top: 0; border-left: 2px solid #f472b6; border-right: 2px solid #f472b6; opacity: 0.8; }
        .lock-cursor { position: absolute; height: 100%; width: 4px; background: #db2777; left: 0; top: 0; transition: none; }
        .lock-success-zone { background-color: #bbf7d0 !important; border-color: #22c55e !important; }

        /* --- TOWER GAME CSS --- */
        #tower-box { width: 300px; height: 400px; background: #f0f9ff; border: 2px solid #bae6fd; position: relative; overflow: hidden; margin: 0 auto; border-radius: 12px; cursor: pointer; }
        .tower-block { position: absolute; height: 25px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); }
        .tower-base { bottom: 0; left: 50px; width: 200px; background: #334155; }
        .moving-block { background: #ec4899; }
        .placed-block { background: #f472b6; }
    </style>
</head>
<body class="m-0 p-4">

    <!-- BACKGROUND MUSIC -->
    <audio id="bg-music" src="background_music.mp3" loop></audio>

    <div id="main-container" class="container-box max-w-lg w-full p-6 md:p-8 rounded-3xl shadow-xl text-center min-h-[450px] flex flex-col justify-center items-center">
        
        <!-- 1. LOGIN STATE -->
        <div id="login-state" class="w-full flex flex-col items-center">
            <div class="text-5xl mb-4">üîí</div>
            <h1 class="cursive text-4xl md:text-5xl text-pink-600 mb-2">Login with Love</h1>
            <p class="text-gray-400 mb-6 text-sm">When did we first meet?</p>
            <input type="text" id="password-input" placeholder="Password..." maxlength="20" class="bg-pink-50 border-2 border-pink-200 text-pink-600 text-center text-xl rounded-full py-2 px-6 mb-4 w-64 placeholder-pink-200 focus:bg-white focus:border-pink-500 focus:outline-none transition-colors">
            <button id="login-btn" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-8 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 text-lg">Enter ‚ù§Ô∏è</button>
            <p id="error-msg" class="text-red-400 text-sm mt-4 hidden animate-pulse">Oops! Wrong pass. Try again üò¢</p>
        </div>

        <!-- 2. ASK STATE -->
        <div id="ask-state" class="w-full hidden relative">
            <div id="heart-icon" class="text-6xl mb-4 md:mb-6 animate-pulse">üíñ</div>
            <h1 id="question-text" class="cursive text-4xl md:text-5xl text-pink-600 mb-6 md:mb-8 leading-tight">Will you be my Valentine?</h1>
            <div class="w-full min-h-[80px] flex flex-wrap items-center justify-center gap-4 md:gap-8 mt-4">
                <button id="yes-button" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 md:px-10 rounded-full shadow-lg transform transition hover:scale-110 active:scale-95 text-lg md:text-xl z-10">Yes!</button>
                <button id="no-button" class="bg-gray-200 text-gray-600 font-bold py-3 px-8 md:px-10 rounded-full shadow-md text-lg md:text-xl cursor-default whitespace-nowrap">No</button>
            </div>
        </div>

        <!-- 3. GAME 1: QUIZ -->
        <div id="quiz-state" class="w-full hidden">
            <h2 class="text-pink-500 text-xl font-bold mb-2">Level 1: The Love Quiz</h2>
            <p class="text-gray-500 mb-6 text-sm">Prove you know me!</p>
            <div id="quiz-container" class="w-full">
                <h3 id="quiz-question" class="text-xl text-gray-700 font-bold mb-6">Question here?</h3>
                <div id="quiz-options" class="flex flex-col gap-3 w-full max-w-xs mx-auto"></div>
            </div>
        </div>

        <!-- 4. GAME 2: CATCH HEARTS -->
        <div id="catch-state" class="w-full hidden h-full">
            <h2 class="text-pink-500 text-xl font-bold mb-2">Level 2: Catch My Heart</h2>
            <p class="text-gray-500 mb-4 text-sm">Tap 10 hearts before time runs out!</p>
            <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                <div id="catch-progress" class="bg-pink-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <div id="catch-area" class="w-full h-64 bg-pink-50 rounded-xl relative overflow-hidden border border-pink-100 shadow-inner cursor-crosshair">
                <div id="start-catch-msg" class="absolute inset-0 flex items-center justify-center text-gray-400 pointer-events-none">Get Ready...</div>
            </div>
        </div>

        <!-- 5. GAME 3: SCAVENGER HUNT -->
        <div id="scavenger-state" class="w-full hidden h-full relative">
            <h2 class="text-pink-500 text-xl font-bold mb-2">Level 3: Hidden Letters</h2>
            <p class="text-gray-500 mb-6 text-sm">Find 3 hidden love letters üíå!</p>
            <div class="text-2xl font-bold text-pink-600 mb-4">Opened: <span id="found-count">0</span>/3</div>
            <div id="scavenger-area" class="w-full h-80 bg-white rounded-xl relative border border-gray-100 overflow-hidden shadow-sm">
                <img src="game_3.gif" alt="Scavenger Hunt Background" class="w-full h-full object-cover">
                <div class="hidden-item" style="bottom: 10px; right: 10px;" onclick="openLetter(this)">üíå</div>
                <div class="hidden-item" style="top: 15px; right: 20px;" onclick="openLetter(this)">üíå</div>
                <div class="hidden-item" style="bottom: 40px; left: 10px;" onclick="openLetter(this)">üíå</div>
                <div id="letter-modal" class="hidden letter-modal">
                    <div class="letter-content">
                        <div class="text-4xl mb-4">üíå</div>
                        <div id="letter-text" class="text-xl font-handwriting text-pink-600 font-bold mb-6 cursive leading-relaxed"></div>
                        <button onclick="closeLetter()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-full shadow-md transition transform hover:scale-105">Keep going ‚ù§Ô∏è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. CELEBRATION STATE -->
        <div id="celebration-state" class="hidden w-full">
            <div class="text-6xl mb-4 animate-bounce">üéâ</div>
            <h1 class="cursive text-4xl md:text-5xl text-pink-600 mb-4">You did it!</h1>
            <p class="text-pink-400 text-lg mb-6">You are officially my Valentine! ‚ù§Ô∏è</p>
            <div class="flex justify-center mb-6">
                <img src="end.gif" alt="Celebration GIF" class="w-48 h-auto rounded-xl shadow-md">
            </div>
            <p class="text-gray-500 italic mb-8">Happy Valentine's Day! üåπ</p>
            
            <div class="border-t border-pink-100 pt-6 mt-6">
                <button id="secret-btn" class="jumpy-btn text-pink-500 hover:text-pink-700 font-bold text-sm underline transition-colors cursor-pointer">
                    Wait, there is one more thing...
                </button>
                <div id="secret-instruction" class="hidden mt-4 bg-pink-50 p-4 rounded-xl border border-pink-200 shadow-inner animate-fade-in">
                    <p class="text-gray-600 text-sm mb-2">Refresh the page and log in with this code:</p>
                    <div class="text-2xl font-bold text-pink-600 tracking-widest font-mono bg-white inline-block px-4 py-2 rounded-lg border border-pink-100 select-all">09122002</div>
                    <p class="text-xs text-gray-400 mt-2">(Use it on the first screen!)</p>
                </div>
            </div>
        </div>

        <!-- 7. SECRET GAME 1: MEMORY -->
        <div id="secret-game-1" class="hidden w-full">
            <div class="text-6xl mb-2">üß©</div>
            <h1 class="cursive text-3xl md:text-4xl text-purple-600 mb-2">Secret Level 1</h1>
            <p class="text-gray-500 text-sm mb-4">Match all pairs before time runs out!</p>
            <div id="memory-timer" class="text-xl font-bold text-pink-500 mb-4">Time: 45s</div>
            <div id="memory-board" class="memory-grid"></div>
            <!-- Win Modal -->
            <div id="secret-win-1" class="hidden absolute inset-0 bg-white/95 flex flex-col justify-center items-center z-50 rounded-3xl">
                <h2 class="text-3xl text-purple-600 font-bold mb-2">Date Unlocked!</h2>
                <div class="text-4xl font-mono bg-purple-100 px-6 py-3 rounded-xl text-purple-800 mb-6 border-2 border-purple-200">05.04.2026</div>
                <button onclick="loadSecretGame2()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg">Next Level ‚û°Ô∏è</button>
            </div>
        </div>

        <!-- 8. SECRET GAME 2: LOVE LOCK -->
        <div id="secret-game-2" class="hidden w-full">
            <div class="text-6xl mb-2">üîì</div>
            <h1 class="cursive text-3xl md:text-4xl text-pink-600 mb-2">Secret Level 2</h1>
            <p class="text-gray-500 text-sm mb-8">Stop the heart in the pink zone!</p>
            
            <div class="w-full max-w-xs mx-auto">
                <div class="flex justify-between text-xs text-gray-400 mb-1">
                    <span>Attempts</span>
                    <span id="lock-level-display">1/3</span>
                </div>
                
                <div class="lock-container" id="lock-bar">
                    <div id="lock-target" class="lock-target"></div>
                    <div id="lock-cursor" class="lock-cursor"></div>
                </div>

                <button id="lock-btn" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 rounded-xl shadow-lg text-xl transition active:scale-95">STOP!</button>
            </div>

            <!-- Win Modal -->
            <div id="secret-win-2" class="hidden absolute inset-0 bg-white/95 flex flex-col justify-center items-center z-50 rounded-3xl p-6 text-center">
                <div class="text-6xl mb-4">üíñ</div>
                <h2 class="text-3xl text-pink-600 font-bold mb-2">Time Unlocked!</h2>
                <div class="text-4xl font-mono bg-pink-100 px-6 py-3 rounded-xl text-pink-800 mb-4 border-2 border-pink-200">15:00</div>
                <p class="text-gray-500 italic mb-6">Create the final password with Date + Time!</p>
                <div class="bg-gray-100 p-2 rounded mb-4 text-xs text-gray-500">
                    Examples:<br>050420261500<br>05.04.2026 15:00
                </div>
                <!-- Changed to reload page for login -->
                <button onclick="location.reload()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg animate-pulse">Back to Login üîÑ</button>
            </div>
        </div>

        <!-- 9. FINAL GAME: TOWER -->
        <div id="tower-state" class="hidden w-full">
            <div class="text-6xl mb-2">üèóÔ∏è</div>
            <h1 class="cursive text-3xl md:text-4xl text-blue-500 mb-2">Final Level</h1>
            <p class="text-gray-500 text-sm mb-4">Build the tower to Level 15!</p>
            <div class="flex justify-between w-[300px] mx-auto text-sm font-bold text-gray-400 mb-1">
                <span>Level: <span id="tower-level" class="text-blue-500">0</span>/15</span>
                <span>Click to drop</span>
            </div>
            
            <div id="tower-box" onclick="placeBlock()">
                <!-- Blocks generated by JS -->
            </div>

            <!-- Final Win Modal -->
            <div id="tower-win" class="hidden absolute inset-0 bg-white/95 flex flex-col justify-center items-center z-50 rounded-3xl p-6 text-center">
                <div class="text-6xl mb-4">üìç</div>
                <h2 class="text-3xl text-blue-600 font-bold mb-2">Coordinates Revealed!</h2>
                <p class="text-gray-500 mb-4">Our date location:</p>
                <div class="text-xl font-mono bg-blue-50 px-4 py-3 rounded-xl text-blue-800 mb-6 border-2 border-blue-200 select-all">
                    40.351344, 49.848197
                </div>
                <p class="text-sm text-gray-400">Can't wait to see you there! ‚ù§Ô∏è</p>
            </div>
        </div>

    </div>

    <div id="bg-hearts"></div>

    <script>
        // --- AUDIO SYSTEM ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function resumeAudio() { if (audioCtx.state === 'suspended') audioCtx.resume(); }
        function playSound(type) {
            resumeAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            if (type === 'pop') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(800, now + 0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'chime') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(400, now); osc.frequency.linearRampToValueAtTime(600, now + 0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.5); osc.start(now); osc.stop(now + 0.5);
            } else if (type === 'success') {
                [440, 554, 659].forEach((freq, i) => { const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type = 'sine'; o.frequency.value = freq; g.gain.setValueAtTime(0.05, now + i*0.1); g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 1); o.start(now + i*0.1); o.stop(now + i*0.1 + 1); });
            } else if (type === 'error') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.2); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.2); osc.start(now); osc.stop(now + 0.2);
            }
        }

        // --- MUSIC CONTROL ---
        function playMusic() {
            const music = document.getElementById('bg-music');
            if (music.paused) {
                music.volume = 0.25;
                music.play().catch(e => console.log("Music blocked until interaction"));
            }
        }

        // --- STATE MANAGEMENT ---
        const states = ['login-state', 'ask-state', 'quiz-state', 'catch-state', 'scavenger-state', 'celebration-state', 'secret-game-1', 'secret-game-2', 'tower-state'];
        function switchState(stateId) {
            playSound('success');
            states.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(stateId).classList.remove('hidden');
            if(stateId === 'quiz-state') loadQuiz();
            if(stateId === 'catch-state') startCatchGame();
            if(stateId === 'scavenger-state') startScavenger();
            if(stateId === 'celebration-state') startHeartRain();
            if(stateId === 'secret-game-1') startMemoryGame();
        }

        // --- LOGIN LOGIC ---
        const passwordInput = document.getElementById('password-input');
        const loginBtn = document.getElementById('login-btn');
        const errorMsg = document.getElementById('error-msg');
        const checkPassword = () => {
            resumeAudio();
            playMusic();
            const val = passwordInput.value.trim();
            // Passwords for the 3rd Page (Tower Game)
            const towerPasswords = ["050420261500", "05.04.2026 15:00", "05.04.2026-15:00", "05.04.2026.15.00"];

            if (val === '22122025') { switchState('ask-state'); window.dispatchEvent(new Event('resize')); } 
            else if (val === '09122002') { switchState('secret-game-1'); } 
            else if (towerPasswords.includes(val)) { switchState('tower-state'); initTowerGame(); } 
            else { errorMsg.classList.remove('hidden'); passwordInput.classList.add('border-red-400'); setTimeout(() => passwordInput.classList.remove('border-red-400'), 500); }
        };
        loginBtn.addEventListener('click', checkPassword);
        passwordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') checkPassword(); });

        // --- SECRET BUTTON ---
        document.getElementById('secret-btn').addEventListener('click', function() { this.classList.add('hidden'); document.getElementById('secret-instruction').classList.remove('hidden'); playSound('chime'); });

        // --- RUNAWAY BUTTON ---
        const container = document.getElementById('main-container'); const noBtn = document.getElementById('no-button'); const yesBtn = document.getElementById('yes-button');
        let hasMoved = false;
        const moveButton = (e) => {
            if (document.getElementById('ask-state').classList.contains('hidden')) return;
            const cr = container.getBoundingClientRect(); const br = noBtn.getBoundingClientRect();
            if (!hasMoved) { noBtn.style.left = (br.left - cr.left) + 'px'; noBtn.style.top = (br.top - cr.top) + 'px'; noBtn.style.position = 'absolute'; hasMoved = true; }
            const mx = (e.type.includes('touch')?e.touches[0].clientX:e.clientX) - cr.left; const my = (e.type.includes('touch')?e.touches[0].clientY:e.clientY) - cr.top;
            for(let i=0; i<40; i++) {
                const rx = 20 + Math.random()*(cr.width-br.width-40); const ry = 20 + Math.random()*(cr.height-br.height-40);
                if (Math.hypot(rx-mx, ry-my) > 120) { noBtn.style.left = rx+'px'; noBtn.style.top = ry+'px'; return; }
            }
        };
        noBtn.addEventListener('mouseover', moveButton); noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveButton(e); });
        yesBtn.addEventListener('click', () => { playSound('pop'); switchState('quiz-state'); });

        // --- QUIZ ---
        const quizData=[{q:"Where did we first meet?",type:"input",validate:v=>["baku","razin","at razin","at my work","my work","work","72 school","school 72","72"].some(a=>v.toLowerCase().includes(a))},{q:"What's our word?",type:"input",validate:v=>v.trim().length>=2&&/^[Ee]+$/.test(v.trim())},{q:"Who loves who more?",type:"input",validate:v=>/\b(i|me|myself|you|u|yourself|both|equal|same|us|we)\b/.test(v.toLowerCase())}];
        let cq=0; function loadQuiz(){ if(cq>=quizData.length){switchState('catch-state');return} const d=quizData[cq]; document.getElementById('quiz-question').innerText=d.q; const od=document.getElementById('quiz-options'); od.innerHTML=''; const i=document.createElement('input'); i.className="bg-pink-50 border-2 border-pink-200 text-pink-600 text-center text-xl rounded-full py-2 px-6 mb-4 w-full focus:outline-none"; const b=document.createElement('button'); b.className="bg-pink-500 text-white font-bold py-2 px-8 rounded-full"; b.innerText="Submit"; b.onclick=()=>{playSound('pop');if(d.validate(i.value)){cq++;loadQuiz()}else{i.classList.add('border-red-400','animate-pulse');setTimeout(()=>i.classList.remove('border-red-400','animate-pulse'),500)}}; od.append(i,b); setTimeout(()=>i.focus(),100); }

        // --- CATCH HEARTS (FIXED LOGIC) ---
        let catchState = { hearts: 0, flowers: 0, fish: 0, phase: 'hearts', flowersDone: false, fishDone: false };
        const targetHearts = 10;
        let catchInterval;
        
        function startCatchGame() {
            document.getElementById('start-catch-msg').style.display = 'flex';
            catchState = { hearts: 0, flowers: 0, fish: 0, phase: 'hearts', flowersDone: false, fishDone: false };
            updateCatchProgress();
            setTimeout(() => { document.getElementById('start-catch-msg').style.display = 'none'; catchInterval = setInterval(gameTick, 600); }, 1000);
        }
        
        function gameTick() {
            const area = document.getElementById('catch-area');
            
            // Phase Logic
            if (catchState.phase === 'hearts') {
                spawnItem(area, 'üíñ', () => {
                    // Prevent incrementing if phase conditions not met
                    if (catchState.phase !== 'hearts') return;

                    playSound('pop'); 
                    catchState.hearts++; 
                    updateCatchProgress();
                    
                    // Checkpoints
                    if (catchState.hearts >= 5 && !catchState.flowersDone) {
                        catchState.phase = 'flowers';
                        clearItems();
                        return;
                    }
                    if (catchState.hearts >= 9 && !catchState.fishDone) {
                        catchState.phase = 'fish';
                        clearItems();
                        return;
                    }
                    if (catchState.hearts >= targetHearts) {
                        clearInterval(catchInterval);
                        setTimeout(() => switchState('scavenger-state'), 500);
                    }
                });
            } 
            else if (catchState.phase === 'flowers') {
                spawnItem(area, ['üå∏', 'üå∫', 'üåª', 'üåπ', 'üå∑'][Math.floor(Math.random()*5)], () => {
                    playSound('pop'); 
                    catchState.flowers++; 
                    triggerFlowerRain();
                    if (catchState.flowers >= 5) {
                        catchState.phase = 'hearts';
                        catchState.flowersDone = true;
                        clearItems();
                    }
                });
            } 
            else if (catchState.phase === 'fish') {
                spawnItem(area, ['üêü', 'üê†', 'üê°'][Math.floor(Math.random()*3)], () => {
                    playSound('pop'); 
                    catchState.fish++; 
                    triggerFishCrowd(catchState.fish === 1 ? 'right' : 'left');
                    if (catchState.fish >= 2) {
                        catchState.phase = 'hearts';
                        catchState.fishDone = true;
                        clearItems();
                    }
                });
            }
        }
        
        function spawnItem(area, icon, cb) {
            const el = document.createElement('div'); el.className = 'catch-item'; el.innerText = icon;
            el.style.left = Math.random() * (area.offsetWidth - 40) + 'px'; el.style.top = Math.random() * (area.offsetHeight - 40) + 'px';
            el.onclick = (e) => { e.stopPropagation(); el.remove(); cb(); };
            setTimeout(() => { if(el.parentNode) el.remove(); }, 1500); area.appendChild(el);
        }
        
        function clearItems() { document.querySelectorAll('.catch-item').forEach(el => el.remove()); }
        function updateCatchProgress() { document.getElementById('catch-progress').style.width = (catchState.hearts / targetHearts) * 100 + '%'; }
        
        function triggerFlowerRain() { 
            for(let i=0; i<80; i++) { 
                const f = document.createElement('div'); f.className = 'falling-flower'; f.innerText = ['üå∏', 'üå∫', 'üåª', 'üåπ', 'üå∑'][Math.floor(Math.random()*5)]; f.style.left = Math.random()*100+'vw'; f.style.animationDuration = (2.5+Math.random()*3)+'s'; f.style.animationDelay = Math.random()*2+'s'; document.body.appendChild(f); setTimeout(() => f.remove(), 6000); 
            } 
        }
        function triggerFishCrowd(dir) { 
            for(let i=0; i<60; i++) { 
                const f = document.createElement('div'); f.className = `swimming-fish ${dir === 'right' ? 'swim-right' : 'swim-left'}`; f.innerText = ['üêü', 'üê†', 'üê°'][Math.floor(Math.random()*3)]; f.style.top = Math.random()*100+'vh'; f.style.animationDuration = (3+Math.random()*4)+'s'; f.style.animationDelay = Math.random()*1.5+'s'; document.body.appendChild(f); setTimeout(() => f.remove(), 8000); 
            } 
        }

        // --- GAME 3: SCAVENGER HUNT ---
        let ifnd=0; const lmsgs=["Ne yax≈üƒ± ki varsan","Ne yax≈üƒ± ki eeee? dedin","Happy valentines day ü§ç"]; function startScavenger(){document.querySelectorAll('.hidden-item').forEach(e=>e.style.display='block')} window.openLetter=e=>{e.style.display='none';playSound('chime');ifnd++;document.getElementById('letter-text').innerHTML=lmsgs.slice(0,ifnd).join('<br><br>');document.getElementById('letter-modal').classList.remove('hidden');if(ifnd>=3)setTimeout(()=>switchState('celebration-state'),800)}; window.closeLetter=()=>document.getElementById('letter-modal').classList.add('hidden');
        function startHeartRain(){setInterval(()=>{const h=document.createElement('div');h.className='heart';h.innerHTML='‚ù§Ô∏è';h.style.left=Math.random()*100+'vw';h.style.animationDuration=Math.random()*2+2+'s';document.body.appendChild(h);setTimeout(()=>h.remove(),4000)},150)}

        // --- SECRET GAME 1: MEMORY ---
        let memoryTimer;
        function startMemoryGame() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            const emojis = ['üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº']; 
            const deck = [...emojis, ...emojis].sort(() => 0.5 - Math.random());
            let flipped = []; let matches = 0; let timeLeft = 45;
            document.getElementById('memory-timer').innerText = `Time: ${timeLeft}s`;
            clearInterval(memoryTimer);
            memoryTimer = setInterval(() => {
                timeLeft--; document.getElementById('memory-timer').innerText = `Time: ${timeLeft}s`;
                if (timeLeft <= 0) { clearInterval(memoryTimer); alert("Time's up! Try again."); startMemoryGame(); }
            }, 1000);
            deck.forEach(emoji => {
                const card = document.createElement('div'); card.className = 'memory-card'; card.dataset.emoji = emoji; card.innerHTML = `<div class="front">‚ùì</div>`;
                card.onclick = () => {
                    if (flipped.length < 2 && !card.classList.contains('flipped')) {
                        playSound('pop'); card.classList.add('flipped'); card.innerHTML = emoji; flipped.push(card);
                        if (flipped.length === 2) {
                            if (flipped[0].dataset.emoji === flipped[1].dataset.emoji) {
                                playSound('chime'); flipped.forEach(c => c.classList.add('matched')); flipped = []; matches++;
                                if (matches === 8) { clearInterval(memoryTimer); playSound('success'); setTimeout(() => document.getElementById('secret-win-1').classList.remove('hidden'), 500); }
                            } else { setTimeout(() => { flipped.forEach(c => { c.classList.remove('flipped'); c.innerHTML = '‚ùì'; }); flipped = []; }, 800); }
                        }
                    }
                }; board.appendChild(card);
            });
        }
        function loadSecretGame2() { document.getElementById('secret-win-1').classList.add('hidden'); document.getElementById('secret-game-1').classList.add('hidden'); document.getElementById('secret-game-2').classList.remove('hidden'); initLockGame(); }

        // --- SECRET GAME 2: LOVE LOCK (SLOWED DOWN FINAL STAGE) ---
        let lockAnim, lockLevel = 1, lockSpeed = 2;
        function initLockGame() {
            const cursor = document.getElementById('lock-cursor'); const target = document.getElementById('lock-target');
            let pos = 0, dir = 1;
            const width = 25 - (lockLevel * 5);
            target.style.width = width + '%'; target.style.left = (Math.random() * (90 - width)) + '%'; target.classList.remove('lock-success-zone');
            document.getElementById('lock-level-display').innerText = `${lockLevel}/3`;
            function animate() { pos += lockSpeed * dir; if (pos > 100 || pos < 0) dir *= -1; cursor.style.left = pos + '%'; lockAnim = requestAnimationFrame(animate); }
            cancelAnimationFrame(lockAnim); lockAnim = requestAnimationFrame(animate);
            document.getElementById('lock-btn').onclick = () => {
                cancelAnimationFrame(lockAnim);
                const cl = parseFloat(cursor.style.left), tl = parseFloat(target.style.left), tw = parseFloat(target.style.width);
                if (cl >= tl && cl <= (tl + tw)) {
                    playSound('chime'); target.classList.add('lock-success-zone');
                    setTimeout(() => {
                        lockLevel++;
                        if (lockLevel === 3) lockSpeed = 4; // SLOWED DOWN (was 5)
                        else lockSpeed += 1.5;
                        if (lockLevel > 3) { playSound('success'); document.getElementById('secret-win-2').classList.remove('hidden'); } else initLockGame();
                    }, 500);
                } else { playSound('error'); const btn = document.getElementById('lock-btn'); btn.classList.add('bg-red-500'); setTimeout(() => { btn.classList.remove('bg-red-500'); initLockGame(); }, 500); }
            };
        }
        function loadTowerGame() { document.getElementById('secret-win-2').classList.add('hidden'); document.getElementById('secret-game-2').classList.add('hidden'); switchState('tower-state'); initTowerGame(); }

        // --- SECRET GAME 3: TOWER BUILDING ---
        let towerLevel = 0; let towerSpeed = 2; let towerAnim; let blockPos = 0; let blockDir = 1; let blockWidth = 100; let towerMoving = true;
        function initTowerGame() { towerLevel = 0; blockWidth = 200; towerSpeed = 2; document.getElementById('tower-box').innerHTML = '<div class="tower-block tower-base" style="width:200px; height:25px; bottom:0; left:50px;"></div>'; document.getElementById('tower-level').innerText = '0'; spawnMovingBlock(); }
        function spawnMovingBlock() {
            const box = document.getElementById('tower-box'); const block = document.createElement('div'); block.className = 'tower-block moving-block'; block.style.width = blockWidth + 'px'; block.style.bottom = ((towerLevel + 1) * 25) + 'px'; block.id = 'active-block'; box.appendChild(block);
            blockPos = 0; towerMoving = true;
            function animateTower() { if(!towerMoving) return; blockPos += towerSpeed * blockDir; const maxPos = 300 - blockWidth; if (blockPos > maxPos || blockPos < 0) blockDir *= -1; block.style.left = blockPos + 'px'; towerAnim = requestAnimationFrame(animateTower); }
            cancelAnimationFrame(towerAnim); animateTower();
        }
        window.placeBlock = function() {
            if(!towerMoving) return; towerMoving = false; cancelAnimationFrame(towerAnim);
            const active = document.getElementById('active-block'); const box = document.getElementById('tower-box');
            const currentLeft = parseFloat(active.style.left) || 0;
            let prevLeft = 50; let prevWidth = 200;
            if (towerLevel > 0) { const prevBlock = box.children[box.children.length - 2]; prevLeft = parseFloat(prevBlock.style.left); prevWidth = parseFloat(prevBlock.style.width); }
            const currentRight = currentLeft + blockWidth; const prevRight = prevLeft + prevWidth;
            const overlapLeft = Math.max(currentLeft, prevLeft); const overlapRight = Math.min(currentRight, prevRight); const overlap = overlapRight - overlapLeft;
            if (overlap > 0) {
                playSound('pop'); active.id = ''; active.classList.remove('moving-block'); active.classList.add('placed-block');
                active.style.width = overlap + 'px'; active.style.left = overlapLeft + 'px'; blockWidth = overlap;
                towerLevel++; document.getElementById('tower-level').innerText = towerLevel;
                if (towerLevel >= 15) { playSound('success'); setTimeout(() => document.getElementById('tower-win').classList.remove('hidden'), 500); } else { towerSpeed += 0.2; setTimeout(spawnMovingBlock, 300); }
            } else { playSound('error'); active.style.backgroundColor = 'red'; setTimeout(() => { alert("Tower collapsed! Try again."); initTowerGame(); }, 500); }
        };
        window.addEventListener('resize', () => { noBtn.style.position = 'static'; hasMoved = false; });
    </script>
</body>
</html>
